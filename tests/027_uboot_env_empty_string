#!/bin/sh
# SPDX-FileCopyrightText: 2018 Frank Hunleth
#
# SPDX-License-Identifier: Apache-2.0

#
# Check that reading an empty string from U-boot gets ignored
#

# This u-boot environment block was created by running:
# printf "serial_number=\n" | mkenvimage -s "1024" - | base64

base64_decode >$WORK/dev/mmcblk0 <<EOF
w8i6sHNlcmlhbF9udW1iZXI9AAD/////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////w==
EOF

cat >$WORK/proc/cpuinfo <<EOF
processor	: 0
model name	: ARMv6-compatible processor rev 7 (v6l)
BogoMIPS	: 2.00
Features	: half thumb fastmult vfp edsp java tls
CPU implementer	: 0x41
CPU architecture: 7
CPU variant	: 0x0
CPU part	: 0xb76
CPU revision	: 7

Hardware	: BCM2708
Revision	: 000e
Serial		: 0000000019f2f468
EOF

CMDLINE="-b uboot_env -f /dev/mmcblk0 -l 1024 -u serial_number -k 0 -b rpi -n 4"

cat >$EXPECTED <<EOF
f468
EOF

